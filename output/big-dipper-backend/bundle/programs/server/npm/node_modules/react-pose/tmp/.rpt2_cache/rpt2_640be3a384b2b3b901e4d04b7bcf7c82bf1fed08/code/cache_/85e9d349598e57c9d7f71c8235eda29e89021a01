{"code":"import { __assign, __rest } from \"tslib\";\r\nimport * as React from 'react';\r\nimport { invariant, warning } from 'hey-listen';\r\nvar getKey = function (child) {\r\n    invariant(child && child.key !== null, 'Every child of Transition must be given a unique key');\r\n    var childKey = typeof child.key === 'number' ? child.key.toString() : child.key;\r\n    return childKey.replace('.$', '');\r\n};\r\nvar prependProps = function (element, props) {\r\n    return React.createElement(element.type, __assign(__assign({ key: element.key, ref: element.ref }, props), element.props));\r\n};\r\nvar handleTransition = function (_a, _b) {\r\n    var displayedChildren = _b.displayedChildren, finishedLeaving = _b.finishedLeaving, hasInitialized = _b.hasInitialized, indexedChildren = _b.indexedChildren, scheduleChildRemoval = _b.scheduleChildRemoval;\r\n    var incomingChildren = _a.children, preEnterPose = _a.preEnterPose, enterPose = _a.enterPose, exitPose = _a.exitPose, animateOnMount = _a.animateOnMount, enterAfterExit = _a.enterAfterExit, flipMove = _a.flipMove, onRest = _a.onRest, propsForChildren = __rest(_a, [\"children\", \"preEnterPose\", \"enterPose\", \"exitPose\", \"animateOnMount\", \"enterAfterExit\", \"flipMove\", \"onRest\"]);\r\n    var targetChildren = makeChildList(incomingChildren);\r\n    var nextState = {\r\n        displayedChildren: []\r\n    };\r\n    if (process.env.NODE_ENV !== 'production') {\r\n        warning(!propsForChildren.onPoseComplete, \"<Transition/> (or <PoseGroup/>) doesn't accept onPoseComplete prop.\");\r\n    }\r\n    var prevKeys = displayedChildren.map(getKey);\r\n    var nextKeys = targetChildren.map(getKey);\r\n    var hasPropsForChildren = Object.keys(propsForChildren).length !== 0;\r\n    var entering = new Set(nextKeys.filter(function (key) { return finishedLeaving.hasOwnProperty(key) || prevKeys.indexOf(key) === -1; }));\r\n    entering.forEach(function (key) { return delete finishedLeaving[key]; });\r\n    var leaving = [];\r\n    var newlyLeaving = {};\r\n    prevKeys.forEach(function (key) {\r\n        if (entering.has(key)) {\r\n            return;\r\n        }\r\n        var isLeaving = finishedLeaving.hasOwnProperty(key);\r\n        if (!isLeaving && nextKeys.indexOf(key) !== -1) {\r\n            return;\r\n        }\r\n        leaving.push(key);\r\n        if (!isLeaving) {\r\n            finishedLeaving[key] = false;\r\n            newlyLeaving[key] = true;\r\n        }\r\n    });\r\n    var moving = new Set(prevKeys.filter(function (key, i) {\r\n        return !entering.has(key) || leaving.indexOf(key) === -1;\r\n    }));\r\n    targetChildren.forEach(function (child) {\r\n        var newChildProps = {};\r\n        if (entering.has(child.key)) {\r\n            if (hasInitialized || animateOnMount) {\r\n                newChildProps.initialPose = preEnterPose;\r\n            }\r\n            newChildProps._pose = enterPose;\r\n        }\r\n        else if (moving.has(child.key) && flipMove) {\r\n            newChildProps._pose = [enterPose, 'flip'];\r\n        }\r\n        else {\r\n            newChildProps._pose = enterPose;\r\n        }\r\n        var newChild = React.cloneElement(child, newChildProps);\r\n        indexedChildren[child.key] = newChild;\r\n        nextState.displayedChildren.push(hasPropsForChildren ? prependProps(newChild, propsForChildren) : newChild);\r\n    });\r\n    leaving.forEach(function (key) {\r\n        var child = indexedChildren[key];\r\n        var newChild = newlyLeaving[key]\r\n            ? React.cloneElement(child, {\r\n                _pose: exitPose,\r\n                onPoseComplete: function (pose) {\r\n                    if (pose === exitPose)\r\n                        scheduleChildRemoval(key);\r\n                    var onPoseComplete = child.props.onPoseComplete;\r\n                    if (onPoseComplete)\r\n                        onPoseComplete(pose);\r\n                },\r\n                popFromFlow: flipMove\r\n            })\r\n            : child;\r\n        var insertionIndex = prevKeys.indexOf(key);\r\n        indexedChildren[child.key] = newChild;\r\n        nextState.displayedChildren.splice(insertionIndex, 0, hasPropsForChildren ? prependProps(newChild, propsForChildren) : newChild);\r\n    });\r\n    return nextState;\r\n};\r\nexport default (function (props, state) {\r\n    var newState = handleTransition(props, state);\r\n    newState.hasInitialized = true;\r\n    return newState;\r\n});\r\nvar makeChildList = function (children) {\r\n    var list = [];\r\n    React.Children.forEach(children, function (child) { return child && list.push(child); });\r\n    return list;\r\n};\r\n//# sourceMappingURL=children.js.map","references":["/Users/mattperry/Sites/popmotion/node_modules/@types/react/index.d.ts","/Users/mattperry/Sites/popmotion/packages/react-pose/src/components/Transition/types.ts","/Users/mattperry/Sites/popmotion/packages/react-pose/src/components/PoseElement/types.ts","/Users/mattperry/Sites/popmotion/node_modules/hey-listen/lib/index.d.ts"],"map":"{\"version\":3,\"file\":\"children.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/components/Transition/children.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/mattperry/Sites/popmotion/packages/react-pose/components/Transition/children.d.ts","writeByteOrderMark":false,"text":"import { Props, State } from './types';\r\ndeclare const _default: (props: Props, state: State) => Partial<State>;\r\nexport default _default;\r\n"}}
