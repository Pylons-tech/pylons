{"code":"import * as tslib_1 from \"tslib\";\r\nimport createPoseSetter from './factories/setter';\r\nimport createValueMap, { DEFAULT_INITIAL_POSE } from './factories/values';\r\nimport generateDefaultTransitions from './factories/transitions';\r\nimport { selectPoses, selectAllValues } from './inc/selectors';\r\nimport { sortByReversePriority } from './inc/utils';\r\nvar poseFactory = function (_a) {\r\n    var getDefaultProps = _a.getDefaultProps, defaultTransitions = _a.defaultTransitions, bindOnChange = _a.bindOnChange, startAction = _a.startAction, stopAction = _a.stopAction, readValue = _a.readValue, readValueFromSource = _a.readValueFromSource, resolveTarget = _a.resolveTarget, setValue = _a.setValue, setValueNative = _a.setValueNative, createValue = _a.createValue, convertValue = _a.convertValue, getInstantTransition = _a.getInstantTransition, getTransitionProps = _a.getTransitionProps, addActionDelay = _a.addActionDelay, selectValueToRead = _a.selectValueToRead, convertTransitionDefinition = _a.convertTransitionDefinition, transformPose = _a.transformPose, posePriority = _a.posePriority, forceRender = _a.forceRender, extendAPI = _a.extendAPI;\r\n    return function (config) {\r\n        var parentValues = config.parentValues, _a = config.ancestorValues, ancestorValues = _a === void 0 ? [] : _a;\r\n        if (parentValues)\r\n            ancestorValues.unshift({ values: parentValues });\r\n        var activeActions = new Map();\r\n        var activePoses = new Map();\r\n        var children = new Set();\r\n        var poses = generateDefaultTransitions(selectPoses(config), defaultTransitions);\r\n        var _b = config.props, props = _b === void 0 ? {} : _b;\r\n        if (getDefaultProps)\r\n            props = tslib_1.__assign({}, getDefaultProps(config), props);\r\n        var passive = config.passive, userSetValues = config.values, _c = config.initialPose, initialPose = _c === void 0 ? DEFAULT_INITIAL_POSE : _c;\r\n        var values = createValueMap({\r\n            poses: poses,\r\n            passive: passive,\r\n            ancestorValues: ancestorValues,\r\n            readValue: readValue,\r\n            setValueNative: setValueNative,\r\n            createValue: createValue,\r\n            convertValue: convertValue,\r\n            readValueFromSource: readValueFromSource,\r\n            userSetValues: userSetValues,\r\n            initialPose: initialPose,\r\n            activePoses: activePoses,\r\n            props: props\r\n        });\r\n        var state = {\r\n            activeActions: activeActions,\r\n            activePoses: activePoses,\r\n            children: children,\r\n            props: props,\r\n            values: values\r\n        };\r\n        var onChange = config.onChange;\r\n        if (onChange)\r\n            Object.keys(onChange).forEach(bindOnChange(values, onChange));\r\n        var set = createPoseSetter({\r\n            state: state,\r\n            poses: poses,\r\n            getInstantTransition: getInstantTransition,\r\n            getTransitionProps: getTransitionProps,\r\n            convertTransitionDefinition: convertTransitionDefinition,\r\n            setValue: setValue,\r\n            setValueNative: setValueNative,\r\n            startAction: startAction,\r\n            stopAction: stopAction,\r\n            resolveTarget: resolveTarget,\r\n            addActionDelay: addActionDelay,\r\n            transformPose: transformPose,\r\n            posePriority: posePriority,\r\n            forceRender: forceRender\r\n        });\r\n        var has = function (poseName) { return !!poses[poseName]; };\r\n        var api = {\r\n            set: set,\r\n            unset: function (poseName, poseProps) {\r\n                var posesToSet = [];\r\n                activePoses.forEach(function (valuePoses) {\r\n                    var poseIndex = valuePoses.indexOf(poseName);\r\n                    if (poseIndex === -1)\r\n                        return;\r\n                    var currentPose = valuePoses[0];\r\n                    valuePoses.splice(poseIndex, 1);\r\n                    var nextPose = valuePoses[0];\r\n                    if (nextPose === currentPose)\r\n                        return;\r\n                    if (posesToSet.indexOf(nextPose) === -1) {\r\n                        posesToSet.push(nextPose);\r\n                    }\r\n                });\r\n                var animationsToResolve = posesToSet\r\n                    .sort(sortByReversePriority(posePriority))\r\n                    .map(function (poseToSet) { return set(poseToSet, poseProps, false); });\r\n                children.forEach(function (child) {\r\n                    return animationsToResolve.push(child.unset(poseName));\r\n                });\r\n                return Promise.all(animationsToResolve);\r\n            },\r\n            get: function (valueName) {\r\n                return valueName\r\n                    ? selectValueToRead(values.get(valueName))\r\n                    : selectAllValues(values, selectValueToRead);\r\n            },\r\n            has: has,\r\n            setProps: function (newProps) { return (state.props = tslib_1.__assign({}, state.props, newProps)); },\r\n            _addChild: function (childConfig, factory) {\r\n                var child = factory(tslib_1.__assign({ initialPose: initialPose }, childConfig, { ancestorValues: [{ label: config.label, values: values }].concat(ancestorValues) }));\r\n                children.add(child);\r\n                return child;\r\n            },\r\n            removeChild: function (child) { return children.delete(child); },\r\n            clearChildren: function () {\r\n                children.forEach(function (child) { return child.destroy(); });\r\n                children.clear();\r\n            },\r\n            destroy: function () {\r\n                activeActions.forEach(stopAction);\r\n                children.forEach(function (child) { return child.destroy(); });\r\n            }\r\n        };\r\n        return extendAPI(api, state, config);\r\n    };\r\n};\r\nexport default poseFactory;\r\n//# sourceMappingURL=index.js.map","map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"src/index.ts\"],\"names\":[],\"mappings\":\"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\"}"}
